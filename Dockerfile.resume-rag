FROM localhost/wsl-python-runner:latest

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Create app directory
WORKDIR /app

# Install Python packages (this is the slow part!)
# Fix NumPy compatibility by installing numpy<2 first
RUN pip install --no-cache-dir "numpy<2.0.0" && \
    pip install --no-cache-dir \
    fastapi==0.110.* \
    uvicorn[standard]==0.29.* \
    sqlalchemy==2.0.* \
    psycopg2-binary==2.9.* \
    pgvector==0.2.* \
    sentence-transformers==2.6.* \
    torch==2.2.* \
    python-dotenv==1.0.* \
    python-multipart==0.0.9 \
    pypdf2==3.0.* \
    openai==1.12.* \
    requests==2.31.*

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Default command
CMD ["bash"]
